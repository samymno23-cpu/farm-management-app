<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olive Farm Pro - Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main-green: #2d5a27; --gold: #c5a059; --bg-light: #f8fdf8; }
        body { background-color: var(--bg-light); font-family: 'Segoe UI', Tahoma, sans-serif; overflow-x: hidden; }
        .top-bar { background: linear-gradient(135deg, var(--main-green), #1b3a18); color: white; padding: 25px 15px; border-radius: 0 0 35px 35px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        .weather-widget { background: rgba(255,255,255,0.9); border-radius: 20px; padding: 12px; margin-top: -30px; border: 1px solid #e0eee0; }
        .stat-card { background: white; border-radius: 20px; padding: 15px; border: none; box-shadow: 0 8px 15px rgba(0,0,0,0.05); text-align: center; }
        .action-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .btn-action { border: none; border-radius: 25px; padding: 20px 10px; font-weight: 600; color: white; transition: 0.3s transform; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .btn-action:active { transform: scale(0.95); }
        .log-item { background: white; border-radius: 15px; margin-bottom: 10px; padding: 12px; border-right: 5px solid var(--main-green); }
        .img-log { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; }
        .bottom-nav { background: white; padding: 10px; border-top: 1px solid #eee; position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; }
    </style>
</head>
<body>

<div class="top-bar text-center">
    <h3 id="currentFarmName" class="fw-bold mb-0">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
    <p class="small opacity-75">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
</div>

<div class="container px-4">
    <div class="weather-widget shadow-sm d-flex justify-content-between align-items-center mb-4">
        <div id="weatherData" class="small fw-bold text-dark">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø·Ù‚Ø³...</div>
        <i class="fas fa-cloud-sun text-warning fs-3"></i>
    </div>

    <div class="row g-3 mb-4 text-center">
        <div class="col-6"><div class="stat-card"> <small class="text-muted">Ø§Ù„Ù…Ø­ØµÙˆÙ„</small> <h4 id="kgTotal" class="mb-0 text-success">0</h4> <small>ÙƒØ¬Ù…</small> </div></div>
        <div class="col-6"><div class="stat-card"> <small class="text-muted">Ø§Ù„Ù…Ø®Ø²Ù†</small> <h4 id="stockTotal" class="mb-0 text-primary">0</h4> <small>ÙˆØ­Ø¯Ø©</small> </div></div>
    </div>

    <div class="action-grid">
        <button class="btn-action shadow" style="background: #27ae60;" onclick="openOp('Ø±ÙŠ')"> <i class="fas fa-droplet fs-3"></i> Ø±ÙŠ </button>
        <button class="btn-action shadow" style="background: #f39c12;" onclick="openOp('ØªØ³Ù…ÙŠØ¯')"> <i class="fas fa-flask fs-3"></i> ØªØ³Ù…ÙŠØ¯ </button>
        <button class="btn-action shadow" style="background: #3498db;" onclick="openOp('Ø±Ø´')"> <i class="fas fa-wind fs-3"></i> Ø±Ø´ </button>
        <button class="btn-action shadow" style="background: #e74c3c;" onclick="openOp('Ø£Ø¹Ø·Ø§Ù„')"> <i class="fas fa-tools fs-3"></i> Ø£Ø¹Ø·Ø§Ù„ </button>
        <button class="btn-action shadow" style="background: #2c3e50;" onclick="openOp('Ø­ØµØ§Ø¯')"> <i class="fas fa-box-open fs-3"></i> Ø­ØµØ§Ø¯ </button>
        <button class="btn-action shadow" style="background: #8e44ad;" onclick="openOp('Ø¹Ù…Ø§Ù„Ø©')"> <i class="fas fa-users fs-3"></i> Ø¹Ù…Ø§Ù„Ø© </button>
    </div>

    <div class="mt-4 mb-5 pb-5">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="fw-bold mb-0">ğŸ“œ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…ØµÙˆØ± Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</h6>
            <button class="btn btn-sm btn-outline-dark" onclick="downloadReport()">ğŸ“‘ ØªÙ‚Ø±ÙŠØ±</button>
        </div>
        <div id="logContent"></div>
    </div>
</div>

<div class="bottom-nav">
    <button class="btn text-success" onclick="location.reload()"><i class="fas fa-home fs-4"></i></button>
    <button class="btn text-secondary" onclick="manageFarms()"><i class="fas fa-layer-group fs-4"></i></button>
    <button class="btn text-secondary" onclick="openReminders()"><i class="fas fa-bell fs-4"></i></button>
    <button class="btn text-secondary" onclick="showSettings()"><i class="fas fa-cog fs-4"></i></button>
</div>

<div class="modal fade" id="mainModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered mx-3">
        <div class="modal-content border-0 shadow" style="border-radius: 25px;">
            <div class="modal-header border-0 pb-0"><h5 id="mTitle" class="fw-bold"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body" id="mBody"></div>
            <div class="px-3 pb-3">
                <div id="imgSection" class="mb-3">
                    <label class="small fw-bold d-block mb-1">ğŸ“¸ ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="file" id="imgIn" class="form-control" accept="image/*">
                </div>
                <button class="btn btn-success w-100 py-3 fw-bold" onclick="saveOp()" style="border-radius:15px;">Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¢Ù†</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let db = JSON.parse(localStorage.getItem('farm_v6_pro')) || {
        currentID: 'f1',
        farms: { 'f1': { name: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø²ÙŠØªÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", logs: [], kg: 0, stock: {} } }
    };
    const modal = new bootstrap.Modal(document.getElementById('mainModal'));
    let curMode = '';

    function getWeather() {
        navigator.geolocation.getCurrentPosition(pos => {
            fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true`)
            .then(r => r.json()).then(d => {
                document.getElementById('weatherData').innerHTML = `ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ: ${d.current_weather.temperature}Â°C | ğŸ’¨ Ø±ÙŠØ§Ø­ ${d.current_weather.windspeed} ÙƒÙ…`;
            });
        }, () => document.getElementById('weatherData').innerText = "ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø·Ù‚Ø³");
    }

    function openOp(mode) {
        curMode = mode; document.getElementById('mTitle').innerText = mode;
        const b = document.getElementById('mBody'); b.innerHTML = '';
        if(mode === 'Ø­ØµØ§Ø¯') b.innerHTML = `<input type="number" id="v1" class="form-control py-3" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù‚Ø·ÙˆÙØ© (ÙƒØ¬Ù…)">`;
        else if(mode === 'ØªØ³Ù…ÙŠØ¯') b.innerHTML = `<select id="v1" class="form-select mb-2"><option>Ù†ØªØ±Ø§Øª</option><option>Ø¨ÙˆØªØ§Ø³ÙŠÙˆÙ…</option><option>ÙŠÙˆØ±ÙŠØ§</option></select><input type="number" id="v2" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">`;
        else if(mode === 'Ø¹Ù…Ø§Ù„Ø©') b.innerHTML = `<input type="text" id="v1" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„"><select id="v2" class="form-select"><option>Ø­Ø¶ÙˆØ±</option><option>Ø¥Ø¬Ø§Ø²Ø©</option></select>`;
        else b.innerHTML = `<textarea id="v1" class="form-control" rows="3" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù‡Ù†Ø§..."></textarea>`;
        modal.show();
    }

    function saveOp() {
        const f = db.farms[db.currentID];
        const log = { d: new Date().toLocaleString('ar-EG'), t: curMode, m: '', img: null };
        const file = document.getElementById('imgIn').files[0];

        if(curMode === 'Ø­ØµØ§Ø¯') { f.kg += parseFloat(document.getElementById('v1').value); log.m = `Ø­ØµØ§Ø¯ ${document.getElementById('v1').value} ÙƒØ¬Ù…`; }
        else if(curMode === 'ØªØ³Ù…ÙŠØ¯') log.m = `Ø§Ø³ØªØ®Ø¯Ø§Ù… ${document.getElementById('v2').value} Ù…Ù† ${document.getElementById('v1').value}`;
        else log.m = document.getElementById('v1').value;

        if (file) {
            const reader = new FileReader();
            reader.onload = e => { log.img = e.target.result; finishSave(f, log); };
            reader.readAsDataURL(file);
        } else { finishSave(f, log); }
    }

    function finishSave(f, log) {
        f.logs.push(log); localStorage.setItem('farm_v6_pro', JSON.stringify(db));
        modal.hide(); render();
    }

    function render() {
        const f = db.farms[db.currentID];
        document.getElementById('currentFarmName').innerText = f.name;
        document.getElementById('kgTotal').innerText = f.kg;
        document.getElementById('logContent').innerHTML = f.logs.map(l => `
            <div class="log-item d-flex align-items-center gap-3">
                ${l.img ? `<img src="${l.img}" class="img-log" onclick="window.open(this.src)">` : '<div class="img-log bg-light text-center pt-2">ğŸŒ³</div>'}
                <div class="flex-grow-1"><div class="fw-bold small">${l.t}</div><div class="text-muted small">${l.m}</div></div>
                <div class="text-muted" style="font-size: 9px;">${l.d.split(',')[0]}</div>
            </div>
        `).reverse().join('');
    }

    function manageFarms() {
        const n = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
        if(n) { const id = 'f'+Date.now(); db.farms[id] = { name: n, logs: [], kg: 0, stock: {} }; db.currentID = id; render(); }
    }

    function downloadReport() {
        let r = `ØªÙ‚Ø±ÙŠØ± ${db.farms[db.currentID].name}\n` + db.farms[db.currentID].logs.map(l => `${l.d}: ${l.t} - ${l.m}`).join('\n');
        const blob = new Blob([r], {type: 'text/plain'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'Report.txt'; a.click();
    }

    getWeather(); render();
</script>
</body>
</html>
