<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ø²ÙŠØªÙˆÙ†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .header-section { background: linear-gradient(135deg, #4b5d16, #2e3b1a); color: white; padding: 20px; border-radius: 0 0 25px 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .card { border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn-action { margin: 2px; border-radius: 8px; font-weight: 500; }
        .stats-box { background: #fff; border-right: 5px solid #4b5d16; padding: 15px; text-align: center; }
        .farm-title { font-weight: bold; color: #fff; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

<div class="header-section text-center">
    <h3 id="farmDisplayTitle" class="farm-title" onclick="renameFarm()">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø±Ù‚Ù… (1)</h3>
    <p class="small">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡</p>
    <select id="farmSelect" class="form-select w-75 mx-auto mt-2" onchange="switchFarm()">
        <option value="farm1">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
        <option value="farm2">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
        <option value="farm3">Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
    </select>
</div>

<div class="container mt-4">
    <div class="row g-3 mb-4">
        <div class="col-6"><div class="stats-box"><span>Ù…Ø­ØµÙˆÙ„ (ÙƒØ¬Ù…)</span><h4 id="inv_kg">0</h4></div></div>
        <div class="col-6"><div class="stats-box" style="border-right-color: #8b4513;"><span>Ø²ÙŠØª (Ù„ØªØ±)</span><h4 id="inv_lt">0</h4></div></div>
    </div>

    <div class="card p-3">
        <h6>ğŸšœ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„ØµÙŠØ§Ù†Ø© (Ù„Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©):</h6>
        <div class="d-flex flex-wrap">
            <button class="btn btn-success btn-action" onclick="addLog('Ø±ÙŠ', 'ÙƒÙ…ÙŠØ© Ø§Ù„Ø±ÙŠ/Ø§Ù„ÙˆÙ‚Øª:')">ğŸ’§ Ø±ÙŠ</button>
            <button class="btn btn-success btn-action" onclick="addLog('ØªØ³Ù…ÙŠØ¯', 'Ù†ÙˆØ¹ Ø§Ù„Ø³Ù…Ø§Ø¯ ÙˆØ§Ù„ÙƒÙ…ÙŠØ©:')">ğŸ§ª ØªØ³Ù…ÙŠØ¯</button>
            <button class="btn btn-success btn-action" onclick="addLog('Ø±Ø´', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¯:')">ğŸ’¨ Ø±Ø´</button>
            <button class="btn btn-danger btn-action" onclick="addLog('ØµÙŠØ§Ù†Ø©', 'ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„ ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­:')">ğŸ› ï¸ Ø£Ø¹Ø·Ø§Ù„ ÙˆØµÙŠØ§Ù†Ø©</button>
            <button class="btn btn-dark btn-action" onclick="addInv('inv_kg', 'ÙƒÙ…ÙŠØ© Ø§Ù„Ø­ØµØ§Ø¯ Ø¨Ø§Ù„ÙƒØ¬Ù…:')">ğŸ“¦ Ø­ØµØ§Ø¯</button>
        </div>
    </div>

    <div class="card p-3">
        <h6>ğŸ‘¥ Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¹Ù…Ø§Ù„Ø© (Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø²Ø±Ø¹Ø©):</h6>
        <div class="d-flex flex-wrap mb-3">
            <button class="btn btn-primary btn-action" onclick="staffLog('Ø­Ø¶ÙˆØ±')">âœ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>
            <button class="btn btn-outline-danger btn-action" onclick="staffLog('ØºÙŠØ§Ø¨')">âŒ ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ§Ø¨</button>
            <button class="btn btn-info btn-action text-white" onclick="staffLog('Ø¥Ø¬Ø§Ø²Ø©')">ğŸ–ï¸ ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø²Ø©</button>
        </div>
        <div class="table-responsive">
            <table class="table table-sm table-bordered text-center small">
                <thead class="table-light">
                    <tr><th>Ø§Ù„Ø¹Ø§Ù…Ù„</th><th>Ø­Ø¶ÙˆØ±</th><th>ØºÙŠØ§Ø¨</th><th>Ø¥Ø¬Ø§Ø²Ø©</th></tr>
                </thead>
                <tbody id="staffTable"></tbody>
            </table>
        </div>
    </div>

    <div class="card p-3">
        <h6>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„:</h6>
        <div id="generalLogs" class="small text-muted" style="max-height: 200px; overflow-y: auto;"></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('farm_system_v2')) || {
        farm1: { name: "Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", logs: [], staff: {}, inv_kg: 0, inv_lt: 0 },
        farm2: { name: "Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", logs: [], staff: {}, inv_kg: 0, inv_lt: 0 },
        farm3: { name: "Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©", logs: [], staff: {}, inv_kg: 0, inv_lt: 0 }
    };

    function switchFarm() {
        let id = document.getElementById('farmSelect').value;
        document.getElementById('farmDisplayTitle').innerText = db[id].name;
        updateUI();
    }

    function renameFarm() {
        let id = document.getElementById('farmSelect').value;
        let newName = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø²Ø±Ø¹Ø©:", db[id].name);
        if (newName) {
            db[id].name = newName;
            document.getElementById('farmDisplayTitle').innerText = newName;
            document.querySelector(`#farmSelect option[value="${id}"]`).innerText = newName;
            save();
        }
    }

    function addLog(type, promptMsg) {
        let id = document.getElementById('farmSelect').value;
        let val = prompt(promptMsg);
        if (val) {
            db[id].logs.push({ d: new Date().toLocaleString('ar-EG'), t: type, m: val });
            save();
        }
    }

    function addInv(key, promptMsg) {
        let id = document.getElementById('farmSelect').value;
        let val = prompt(promptMsg);
        if (val && !isNaN(val)) {
            db[id][key] += parseFloat(val);
            db[id].logs.push({ d: new Date().toLocaleString('ar-EG'), t: "Ù…Ø®Ø²ÙˆÙ†", m: "Ø¥Ø¶Ø§ÙØ© " + val });
            save();
        }
    }

    function staffLog(status) {
        let id = document.getElementById('farmSelect').value;
        let name = prompt("Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„:");
        if (name) {
            if (!db[id].staff[name]) db[id].staff[name] = { Ø­Ø¶ÙˆØ±: 0, ØºÙŠØ§Ø¨: 0, Ø¥Ø¬Ø§Ø²Ø©: 0 };
            db[id].staff[name][status]++;
            db[id].logs.push({ d: new Date().toLocaleDateString('ar-EG'), t: "Ø¹Ù…Ø§Ù„Ø©", m: `${status}: ${name}` });
            save();
        }
    }

    function updateUI() {
        let id = document.getElementById('farmSelect').value;
        let f = db[id];
        document.getElementById('inv_kg').innerText = f.inv_kg;
        document.getElementById('inv_lt').innerText = f.inv_lt;
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„Ø©
        let sTable = '';
        for (let name in f.staff) {
            sTable += `<tr><td>${name}</td><td>${f.staff[name].Ø­Ø¶ÙˆØ±}</td><td>${f.staff[name].ØºÙŠØ§Ø¨}</td><td>${f.staff[name].Ø¥Ø¬Ø§Ø²Ø©}</td></tr>`;
        }
        document.getElementById('staffTable').innerHTML = sTable;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
        document.getElementById('generalLogs').innerHTML = f.logs.map(l => `<div>[${l.d}] <b>${l.t}:</b> ${l.m}</div>`).reverse().join('');
    }

    function save() {
        localStorage.setItem('farm_system_v2', JSON.stringify(db));
        updateUI();
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    document.querySelectorAll('#farmSelect option').forEach(opt => {
        opt.innerText = db[opt.value].name;
    });
    switchFarm();
</script>
</body>
</html>
