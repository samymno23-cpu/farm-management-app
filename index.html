<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGRO-AI Pro 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root { --ai-gradient: linear-gradient(135deg, #1d4d1a 0%, #3a7d34 100%); --glass: rgba(255, 255, 255, 0.9); }
        body { background: #f0f2f5; font-family: 'Segoe UI', system-ui, -apple-system; padding-bottom: 100px; color: #1a1a1a; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .page { display: none; min-height: 100vh; padding: 20px; background: #fff; position: fixed; top: 0; left: 0; width: 100%; z-index: 2000; overflow-y: auto; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .page.active { display: block; animation: slideUp 0.4s ease-out; }
        
        .ai-header { background: var(--ai-gradient); color: white; padding: 30px 20px; border-radius: 0 0 40px 40px; box-shadow: 0 10px 30px rgba(29, 77, 26, 0.3); }
        .ai-card { background: var(--glass); backdrop-filter: blur(10px); border-radius: 25px; border: 1px solid rgba(255,255,255,0.3); padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .stat-val { font-size: 1.8rem; font-weight: 800; color: #2d5a27; }
        .btn-smart { border: none; border-radius: 22px; padding: 20px 10px; color: white; transition: all 0.3s; display: flex; flex-direction: column; align-items: center; gap: 10px; font-weight: 700; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-smart:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        
        .bottom-bar { background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid #eee; z-index: 1000; }
        
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .ai-badge { background: #e8f5e9; color: #2e7d32; padding: 5px 15px; border-radius: 50px; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

<div id="homePage" class="active">
    <div class="ai-header text-center">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="ai-badge"><i class="fas fa-robot"></i> AI Active</span>
            <button class="btn btn-sm btn-light rounded-circle" onclick="showPage('farmsPage')"><i class="fas fa-layer-group"></i></button>
        </div>
        <h2 id="farmTitle" class="fw-bold">...</h2>
        <div id="weatherBox" class="small opacity-75 mt-2"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³...</div>
    </div>

    <div class="container mt-n4 px-3">
        <div class="ai-card border-start border-success border-5 mt-n4">
            <h6 class="fw-bold"><i class="fas fa-lightbulb text-warning"></i> ØªÙˆØµÙŠØ© AI Ø§Ù„ÙŠÙˆÙ…:</h6>
            <p id="aiRecommendation" class="small mb-0 text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù†ØµÙŠØ­Ø©...</p>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-6"><div class="ai-card text-center mb-0"> <small class="text-muted">Ø§Ù„Ù…Ø­ØµÙˆÙ„</small> <div id="kgView" class="stat-val text-success">0</div> </div></div>
            <div class="col-6"><div class="ai-card text-center mb-0"> <small class="text-muted">Ø§Ù„Ù…Ø®Ø²Ù†</small> <div id="stockView" class="stat-val text-primary">0</div> </div></div>
        </div>

        <div class="row g-3">
            <div class="col-4"><button class="btn-smart w-100" style="background:#2ecc71" onclick="showPage('opPage', 'Ø±ÙŠ')"><i class="fas fa-faucet-drip fs-3"></i> Ø±ÙŠ</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#f1c40f" onclick="showPage('opPage', 'ØªØ³Ù…ÙŠØ¯')"><i class="fas fa-seedling fs-3"></i> ØªØ³Ù…ÙŠØ¯</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#3498db" onclick="showPage('opPage', 'Ø±Ø´')"><i class="fas fa-spray-can fs-3"></i> Ø±Ø´</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#e67e22" onclick="showPage('opPage', 'ØªÙ‚Ù„ÙŠÙ…')"><i class="fas fa-shears fs-3"></i> ØªÙ‚Ù„ÙŠÙ…</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#34495e" onclick="showPage('opPage', 'Ø®Ø¯Ù…Ø© Ø´ØªÙˆÙŠØ©')"><i class="fas fa-snowflake fs-3"></i> Ø´ØªÙˆÙŠØ©</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#e74c3c" onclick="showPage('opPage', 'Ø£Ø¹Ø·Ø§Ù„')"><i class="fas fa-tools fs-3"></i> Ø£Ø¹Ø·Ø§Ù„</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#2c3e50" onclick="showPage('opPage', 'Ø­ØµØ§Ø¯')"><i class="fas fa-box-open fs-3"></i> Ø­ØµØ§Ø¯</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#8e44ad" onclick="showPage('staffPage')"><i class="fas fa-id-card fs-3"></i> Ø§Ù„Ø¹Ù…Ø§Ù„Ø©</button></div>
            <div class="col-4"><button class="btn-smart w-100" style="background:#7f8c8d" onclick="showPage('opPage', 'Ø£Ø®Ø±Ù‰')"><i class="fas fa-ellipsis-h fs-3"></i> Ø£Ø®Ø±Ù‰</button></div>
        </div>
    </div>
</div>

<div id="opPage" class="page">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 id="opTitle" class="fw-bold mb-0"></h4>
        <button class="btn btn-dark rounded-pill px-4" onclick="hideAllPages()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div id="opContent" class="mb-4"></div>
    <div class="ai-card bg-light border-0">
        <label class="fw-bold mb-2">ğŸ“¸ Ø§Ù„ØªÙ‚Ø· ØµÙˆØ±Ø© Ø£Ùˆ Ø£Ø±ÙÙ‚ Ù…Ø³ØªÙ†Ø¯Ø§Ù‹:</label>
        <input type="file" id="opImage" class="form-control" accept="image/*">
    </div>
    <button class="btn btn-success w-100 py-3 rounded-4 fs-5 fw-bold mt-3 shadow" onclick="saveData()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ­ÙØ¸Ù‡Ø§</button>
</div>

<div id="staffPage" class="page">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold">Ø¯ÙØªØ± Ø§Ù„Ø¹Ù…Ø§Ù„Ø© Ø§Ù„Ø°ÙƒÙŠ</h4>
        <button class="btn btn-dark rounded-pill" onclick="hideAllPages()">Ø¹ÙˆØ¯Ø©</button>
    </div>
    <div class="ai-card">
        <div class="mb-3">
            <input type="text" id="workerName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„">
            <div class="d-flex gap-2">
                <button class="btn btn-success flex-grow-1" onclick="regWorker('Ø­Ø¶ÙˆØ±')">Ø­Ø¶ÙˆØ± âœ…</button>
                <button class="btn btn-danger flex-grow-1" onclick="regWorker('ØºÙŠØ§Ø¨')">ØºÙŠØ§Ø¨ âŒ</button>
                <button class="btn btn-info text-white flex-grow-1" onclick="regWorker('Ø¥Ø¬Ø§Ø²Ø©')">Ø¥Ø¬Ø§Ø²Ø© ğŸ–ï¸</button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-sm text-center">
                <thead><tr class="small"><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø¹Ø§Ù…Ù„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="staffTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<div class="bottom-bar shadow">
    <button class="btn text-success" onclick="hideAllPages()"><i class="fas fa-home fs-4"></i></button>
    <button class="btn text-secondary" onclick="showPage('farmsPage')"><i class="fas fa-list-check fs-4"></i></button>
    <button class="btn text-secondary" onclick="showPage('stockPage')"><i class="fas fa-warehouse fs-4"></i></button>
    <button class="btn text-secondary" onclick="showPage('archivePage')"><i class="fas fa-history-fixed fs-4"></i></button>
    <button class="btn text-secondary" onclick="genReport()"><i class="fas fa-file-pdf fs-4"></i></button>
</div>

<script>
    // Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† Ø°ÙƒÙŠ Ù„Ø§ ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
    const DB_KEY = 'AGRO_AI_PRO_2026_MASTER';
    let db = JSON.parse(localStorage.getItem(DB_KEY)) || {
        cur: 'f1',
        farms: { 'f1': { name: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø²ÙŠØªÙˆÙ† Ø§Ù„Ø°ÙƒÙŠØ©", logs: [], kg: 0, stock: {}, staff: [] } }
    };

    let activeOp = '';

    function showPage(id, op = '') {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if (op) {
            activeOp = op; document.getElementById('opTitle').innerText = op;
            renderFields(op);
        }
        if(id === 'staffPage') renderStaff();
    }

    function hideAllPages() {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        renderHome();
    }

    function renderFields(op) {
        const c = document.getElementById('opContent');
        const f = db.farms[db.cur];
        if (op === 'ØªØ³Ù…ÙŠØ¯') {
            let opts = Object.keys(f.stock).map(k => `<option value="${k}">${k} (Ù…ØªØ§Ø­: ${f.stock[k]})</option>`).join('');
            c.innerHTML = `<select id="i1" class="form-select mb-3">${opts || '<option>Ø§Ù„Ù…Ø®Ø²Ù† ÙØ§Ø±Øº</option>'}</select><input type="number" id="i2" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©">`;
        } else if (op === 'Ø­ØµØ§Ø¯') {
            c.innerHTML = `<input type="number" id="i1" class="form-control mb-3" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù‚Ø·ÙˆÙØ© ÙƒØ¬Ù…">`;
        } else {
            c.innerHTML = `<textarea id="i1" class="form-control" rows="8" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ø¹Ù† ${op}..."></textarea>`;
        }
    }

    function saveData() {
        const f = db.farms[db.cur]; let msg = "";
        const v1 = document.getElementById('i1')?.value;
        const v2 = document.getElementById('i2')?.value;

        if (activeOp === 'ØªØ³Ù…ÙŠØ¯') {
            if (f.stock[v1] >= v2) { f.stock[v1] -= v2; msg = `ØªØ³Ù…ÙŠØ¯: ${v1} Ø¨ÙƒÙ…ÙŠØ© ${v2}`; }
            else { alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† Ù„Ø§ ÙŠÙƒÙÙŠ!"); return; }
        } else if (activeOp === 'Ø­ØµØ§Ø¯') {
            f.kg += parseFloat(v1 || 0); msg = `Ø­ØµØ§Ø¯ ${v1} ÙƒØ¬Ù…`;
        } else { msg = v1; }

        f.logs.push({ d: new Date().toLocaleString('ar-EG'), t: activeOp, m: msg });
        sync(); hideAllPages();
    }

    function regWorker(stat) {
        const n = document.getElementById('workerName').value;
        if(!n) return;
        db.farms[db.cur].staff.push({ n: n, s: stat, d: new Date().toLocaleDateString('ar-EG') });
        sync(); renderStaff();
    }

    function renderStaff() {
        const h = db.farms[db.cur].staff.map((w, idx) => `<tr><td>${w.d}</td><td class="fw-bold">${w.n}</td><td>${w.s}</td><td><button class="btn btn-sm btn-link text-danger" onclick="delStaff(${idx})">Ø­Ø°Ù</button></td></tr>`).reverse().join('');
        document.getElementById('staffTableBody').innerHTML = h;
    }

    function renderHome() {
        const f = db.farms[db.cur];
        document.getElementById('farmTitle').innerText = f.name;
        document.getElementById('kgView').innerText = f.kg;
        document.getElementById('stockView').innerText = Object.keys(f.stock).length;
        
        // Ù…Ø­Ø±Ùƒ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        if (f.logs.length === 0) {
            document.getElementById('aiRecommendation').innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØ› Ø§Ø¨Ø¯Ø£ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ AI.";
        } else {
            const lastOp = f.logs[f.logs.length - 1];
            document.getElementById('aiRecommendation').innerText = `Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¢Ø®Ø± ${lastOp.t}ØŒ Ù†Ù†ØµØ­ Ø¨Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠ Ø®Ù„Ø§Ù„ Ø§Ù„Ù€ 48 Ø³Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.`;
        }
    }

    function sync() { localStorage.setItem(DB_KEY, JSON.stringify(db)); }
    function delStaff(idx) { db.farms[db.cur].staff.splice(idx, 1); sync(); renderStaff(); }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù‚Ø³ ÙˆØªØ­Ù„ÙŠÙ„Ù‡
    navigator.geolocation.getCurrentPosition(p => {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current_weather=true`)
        .then(r => r.json()).then(data => {
            const temp = data.current_weather.temperature;
            const desc = temp > 30 ? "ğŸŒ¡ï¸ Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø©: Ø²Ø¯ ÙØªØ±Ø§Øª Ø§Ù„Ø±ÙŠ" : temp < 10 ? "â„ï¸ Ø¨Ø±ÙˆØ¯Ø©: Ø§Ù†ØªØ¨Ù‡ Ù…Ù† Ø§Ù„ØµÙ‚ÙŠØ¹" : "âœ… Ø·Ù‚Ø³ Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø¹Ù…Ù„";
            document.getElementById('weatherBox').innerHTML = `Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${temp}Â°C | ${desc}`;
        });
    });

    renderHome();
</script>
</body>
</html>
